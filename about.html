<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About Page</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="stylesheet.css">

</head>
<body>
          
          <h1>QR Code Reader</h1>

<img id="qr" width="100" style="display: none">
<output>No details</output>

<h2>Take a photo</h2>

<input type="file" accept="image/*" capture="user">

<h2>Scan with live streaming</h2>

<input type="button" value="Start Camera" id="btnStartCamera">
<input type="button" value="Take Snapshot" id="btnTakeSnapshot">
    
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D3VBGZG859"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(){
    var fileSelector = document.querySelector("input[type=file]");
    var qr = document.querySelector("#qr");

    fileSelector.addEventListener("change", function(){
        var reader = new FileReader();

        reader.addEventListener("load", function(e){
            qr.style.display = "block"
            qr.src = e.target.result;
        });
        reader.readAsDataURL(fileSelector.files[0]);
    });

    var btnStartCamera = document.querySelector("#btnStartCamera");
    var btnTakeSnapshot = document.querySelector("#btnTakeSnapshot")
    btnStartCamera.addEventListener("click", startCamera);
    btnTakeSnapshot.addEventListener("click", getSnapshot);
});

qrcode.callback = function(data){
    var output = document.querySelector(output);
    output.innerHTML = "QR code data" + data
}

function startCamera(){
    if(navigator.getUserMedia != undefined){
        navigator.getUserMedia({video:true, audio:true}, function(localMediaStream){
            var video = document.querySelector("video");
            video.src = window.URL.createObjectURL(localMediaStream);
            video.play();
        }, function(){
            alert("Error opening the camera");
        });
    }else{
        alert("You don't have camera access");
    }
}

function getSnapshot(){
    var video = document.querySelector("video");

    var canvas = document.createElement("canvas");
    canvas.width = 640;
    canvas.height = 480;
    var ctx = canvas.getContext("2d");

    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    return canvas.toDataURL('image/jpeg');
}
</script>
</body>
</html>